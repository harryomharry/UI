</html>
<!doctype html>
<html ng-app="crudapp">
<head>
    <title>Offers</title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link type="text/css" rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link href="http://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">
    <link rel="stylesheet" href="http://getbootstrap.com/dist/css/bootstrap.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>


</head>
<style>
.page-header { vertical-align: bottom;}
h1 {color:#4DA820;
    font: "Helvetica";
    font-size: 60px;
  }

.modal-dialog{
    position: relative;
    display: table;
    overflow-y: auto;    
    overflow-x: auto;
    width: auto;
    min-width: 300px;
    max-height: 300px   
}
</style>
 
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="http://127.0.0.1:8000/home">Home</a>
    </div>
    <ul class="nav navbar-nav">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Clients
        <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="http://127.0.0.1:8000/Morrison/campaigns">Morrisons</a></li>
        </ul>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right">
      <li><a href="/logout/"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
    </ul>
  </div>
</nav>

<div class="container">
  <h3><strong>Offers</strong></h3>
  {% verbatim %}
  <h4>
    <strong>
      <table>
        <tr>
          <td><strong>Campaign:</strong> {{selcamp}}</td>
        </tr>
        <tr>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td><strong>Client Name:</strong> {{client_name}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Client Number:</strong> {{client_num}}</td>
        </tr>
      </table>
    </strong> 
  </h4>

  {% endverbatim %}
  <hr>
</div>



<div class="container">
<body ng-controller="productController" ng-cloak onload="document.refresh();">

  <div class='page-header'>
    <div class='btn-toolbar pull-right'>
      <div class='btn-group'>
        <button type="button" class="btn btn-info btn" ng-click="export()" onclick="exp_redirect()">
          <span class="glyphicon glyphicon-export"></span> Excel Export
        </button>
        <button type="button" class="btn btn-danger btn" ng-click="sub_data1()">
          Save Session <span class="glyphicon glyphicon-floppy-disk"></span> 
        </button>
      </div>
    </div>
    <h3>Existing Offers</h3>
  </div>


    <div ng-show="oblank">
      <span style="font-size:20px; color:red;">There are currently no records</span>
      <br>
    </div>

    <div ng-show="otable">
      {% verbatim %}

    

    <table class="table table-striped table-bordered table-hover table-condensed table-responsive"  
    cellpadding="5" cellspacing="0" border="1">
      <thead>
        <tr>
          <th>Row</th>
          <th>Precima Offer ID</th>
          <th>Precima Offer #</th>
          <th>Unica Code</th>
          <th>Max Incentive</th>
          <th># of Products</th>

          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="item in offers">
          <td>{{item.id = $index + 1}}</td>
          <td>{{item.precimaOfferID}}</td>
          <td>{{item.precimaOfferNumber}}</td>
          <td>{{item.unicaCode}}</td>
          <td>{{item.maxIncentive}}</td>
          <td>{{item.counter}}</td>

          <td>
            <div class="btn-group" style="width: 100%;">
              <button type="button" class="btn btn-success btn-xs" data-toggle="modal" data-target="#selectModal" ng-click="sel_offer(item.id)">
                <span class="glyphicon glyphicon-menu-right"></span>
              </button>
              <button type="button" class="btn btn-warning btn-xs" data-toggle="modal" data-target="#edititem" ng-click="selectEdit(item.id)">
                <span class="glyphicon glyphicon-edit"></span>
              </button>
              <button type="button" class="btn btn-danger btn-xs"  ng-click="del(item.id)">
                <span class="glyphicon glyphicon-remove"></span>
              </button>
            </div>                    
          </td>
        </tr>
    </tbody>  
  </table>
  {% endverbatim %}
 
  <br>
  

  <div class="modal fade" id="selectModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Confirm Seletion</h4>
        </div>
        {% verbatim %}
        <div class="modal-body">
          <p>Would you like to continue with offer # {{offeridsend}}?</p>
        </div>
        {% endverbatim %}
        <div class="modal-footer">
        {% csrf_token %}
          <button type="button" class="btn btn-success" data-dismiss="modal" ng-click="sub_data()" onclick="redirect()">Yes</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
        </div>
      </div>
      
    </div>
  </div>

{% verbatim %}

{% endverbatim %}
  <br>
  </div>
  <!-- Modal -->

    <div class="modal fade" id="edititem" role="dialog">
        <div class="modal-dialog">
    
      <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    {% verbatim %}
                    <h4 class="modal-title"><strong>Edit Offer: {{editoffer}}</strong></h4>
                    {% endverbatim %}
                </div>
                <div class="modal-body">
                    <div>
                        <form name="editform" method="post" role=form>
                            <table>
                                <tr>
                                    <td>
                                        <label>Precima Offer Number:</label>
                                        <input class="form-control" id="focusedInput" type="number" style="width:250px"; ng-model="e_pon"  readonly/>
                                        <span style="width:250px; color:red;" class="help-block" id="e_pon_e"></span>
                                    </td>
                                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                    <td>
                                        <label>Image IDDM:</label> 
                                        <input class="form-control" id="focusedInput" type="text" style="width:250px"; ng-model="e_iiddm"/>
                                        <span style="width:250px; color:red;" class="help-block" id="e_iiddm_e"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>Bar Code 1:</label> 
                                        <input class="form-control" id="focusedInput" type="text" style="width:250px"; ng-model="e_bc1"/>
                                        <span style="width:250px; color:red;" class="help-block" id="e_bc1_e"></span>
                                    </td>
                                    <td>&nbsp;&nbsp;</td>
                                    <td>
                                        <label>Image ID Catalina:</label> 
                                        <input class="form-control" id="focusedInput" type="text" style="width:250px"; ng-model="e_iidc"/>
                                        <span style="width:250px; color:red;" class="help-block" id="e_iidc_e"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>Valassis Code 1:</label>

                                        <input class="form-control" id="focusedInput" type="text" style="width:250px"; ng-model="e_vc1" />
                                        <span style="width:250px; color:red;" class="help-block" id="e_vc1_e"></span>
                                    </td>
                                    <td>&nbsp;&nbsp;</td>
                                    <td>
                                        <label>Image ID Email:</label> 
                                        <input class="form-control" id="focusedInput" type="text" style="width:250px"; ng-model="e_iide"/>
                                        <span style="width:250px; color:red;" class="help-block" id="e_iide_e"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>Unica Code:</label> 
                                        <input class="form-control" id="focusedInput" type="text" style="width:250px"; ng-model="e_uc"/>
                                        <span style="width:250px; color:red;" class="help-block" id="e_uc_e"></span>
                                    </td>
                                    <td>&nbsp;&nbsp;</td>
                                    <td>
                                        <label>Max Client Fee:</label> 
                                        <input class="form-control" id="focusedInput" type="number" style="width:250px"; ng-model="e_mcf"/>
                                        <span style="width:250px; color:red;" class="help-block" id="e_mcf_e"></span>
                                    </td>
                                </tr>
                                <tr>
                                     <td>
                                        <label>Bar Code 2:</label>
                                        <input class="form-control" id="focusedInput" type="text" style="width:250px"; ng-model="e_bc2" />
                                        <span style="width:250px; color:red;" class="help-block" id="e_bc2_e"></span>
                                    </td>
                                    <td>&nbsp;&nbsp;</td>
                                    <td>
                                        <label>Min Incentive:</label> 
                                        <input class="form-control" id="focusedInput" type="number" style="width:250px"; ng-model="e_mini"/>
                                        <span style="width:250px; color:red;" class="help-block" id="e_mini_e"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>Valassis Code 2:</label> 
                                        <input class="form-control" id="focusedInput" type="text" style="width:250px"; ng-model="e_vc2"/>
                                        <span style="width:250px; color:red;" class="help-block" id="e_vc2_e"></span>
                                    </td>
                                    <td>&nbsp;&nbsp;</td>
                                    <td>
                                        <label>Max Incentive:</label> 
                                        <input class="form-control" id="focusedInput" type="number" style="width:250px"; ng-model="e_maxi"/>
                                        <span style="width:250px; color:red;" class="help-block" id="e_maxi_e"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>e Code:</label>
                                        <input class="form-control" id="focusedInput" type="text" style="width:250px"; ng-model="e_ec" />
                                        <span style="width:250px; color:red;" class="help-block" id="e_ec_e"></span>
                                    </td>
                                    <td>&nbsp;&nbsp;</td>
                                    <td>
                                        <label>Min Point:</label> 
                                        <input class="form-control" id="focusedInput" type="number" style="width:250px"; ng-model="e_minp"/>
                                        <span style="width:250px; color:red;" class="help-block" id="e_minp_e"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>Brand Name:</label>
                                        <input class="form-control" id="focusedInput" type="text" style="width:250px"; ng-model="e_bn" />
                                        <span style="width:250px; color:red;" class="help-block" id="e_bn_e"></span>
                                    </td>
                                    <td>&nbsp;&nbsp;</td>
                                    <td>
                                        <label>Max Point:</label> 
                                        <input class="form-control" id="focusedInput" type="number" style="width:250px"; ng-model="e_maxp"/>
                                        <span style="width:250px; color:red;" class="help-block" id="e_maxp_e"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>Offer Copy:</label>
                                        <input class="form-control" id="focusedInput" type="text" style="width:250px"; ng-model="e_oc" />
                                        <span style="width:250px; color:red;" class="help-block" id="e_oc_e"></span>
                                    </td>
                                    <td>&nbsp;&nbsp;</td>
                                    <td>
                                        <label>Ad ID:</label> 
                                        <input class="form-control" id="focusedInput" type="text" style="width:250px"; ng-model="e_adid"/>
                                        <span style="width:250px; color:red;" class="help-block" id="e_adid_e"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>Sub Copy:</label>
                                        <input class="form-control" id="focusedInput" type="text" style="width:250px"; ng-model="e_sc" />
                                        <span style="width:250px; color:red;" class="help-block" id="e_sc_e"></span>
                                    </td>
                                    <td>&nbsp;&nbsp;</td>
                                    <td>
                                        &nbsp;
                                    </td>
                                </tr>
                            </table>
                        </form>
                    </div>
                    <div>
                      <span  style="color:green;" class="help-block" id="saved"></span>
                    </div>
              </div>
        <div class="modal-footer">
            <button type="submit" class="btn btn-info"  ng-click="edit()">Save Edit</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
    </div>
      
    </div>
  </div>

<button type="button" class="btn btn-info" data-toggle="collapse" data-target="#demo">Create New Offer</button>
<div id="demo" class="collapse">
  <div class="jumbotron" >
  <h3><strong>Create New Offer</strong></h3>
  <hr>
    <div class="row">
      <form name="offerform" method="post" role=form>

      <div class="col-md-6">
        <label>Precima Offer Number:</label>
        <input class="form-control" id="focusedInput" type="number" ng-model="pon" required/>
        <span style="width:500px; color:red;" class="help-block" id="pon_error"></span>
  

        <label>Bar Code 1:</label>
        <input class="form-control" id="focusedInput" type="text" ng-model="bc1" />
        <span style="width:500px; color:red;" class="help-block" id="bc1_error"></span>
   

        <label>Valassis Code 1:</label>
        <input class="form-control" id="focusedInput" type="text" ng-model="vc1" />
        <span style="width:500px; color:red;" class="help-block" id="vc1_error"></span>


        <label>Unica Code:</label>
        <input class="form-control" id="focusedInput" type="text" ng-model="uc" />
        <span style="width:500px; color:red;" class="help-block" id="uc_error"></span>


        <label>Bar Code 2:</label>
        <input class="form-control" id="focusedInput" type="text" ng-model="bc2" />
        <span style="width:500px; color:red;" class="help-block" id="bc2_error"></span>
 

        <label>Valassis Code 2:</label>
        <input class="form-control" id="focusedInput" type="text" ng-model="vc2" />
        <span style="width:500px; color:red;" class="help-block" id="vc2_error"></span>


        <label>e Code:</label>
        <input class="form-control" id="focusedInput" type="text" ng-model="ec" />
        <span style="width:500px; color:red;" class="help-block" id="ec_error"></span>

        <label>Brand Name:</label>
        <input class="form-control" id="focusedInput" type="text" ng-model="bn" />
        <span style="width:500px; color:red;" class="help-block" id="bn_error"></span>

        <label>Offer Copy:</label>
        <input class="form-control" id="focusedInput" type="text" ng-model="oc" />
        <span style="width:500px; color:red;" class="help-block" id="oc_error"></span>

        <label>Sub Copy:</label>
        <input class="form-control" id="focusedInput" type="text" ng-model="sc" />
        <span style="width:500px; color:red;" class="help-block" id="sc_error"></span>


      </div>
      <div class="col-md-6">
        <label>Image IDDM:</label>
        <input class="form-control" id="focusedInput" type="text" ng-model="iiddm" />
        <span style="width:500px; color:red;" class="help-block" id="iiddm_error"></span>

        <label>Image ID Catalina:</label>
        <input class="form-control" id="focusedInput" type="text" ng-model="iidc" />
        <span style="width:500px; color:red;" class="help-block" id="iidc_error"></span>

        <label>Image ID Email:</label>
        <input class="form-control" id="focusedInput" type="text" ng-model="iide" />
        <span style="width:500px; color:red;" class="help-block" id="iide_error"></span>

        <label>Max Client Fee:</label>
        <input class="form-control" id="focusedInput" type="number" ng-model="mcf" />
        <span style="width:500px; color:red;" class="help-block" id="mcf_error"></span>

        <label>Min Incentive:</label>
        <input class="form-control" id="focusedInput" type="number" ng-model="mini" />
        <span style="width:500px; color:red;" class="help-block" id="mini_error"></span>

        <label>Max Incentive:</label>
        <input class="form-control" id="focusedInput" type="number" ng-model="maxi" />
        <span style="width:500px; color:red;" class="help-block" id="maxi_error"></span>

        <label>Min Point:</label>
        <input class="form-control" id="focusedInput" type="number" ng-model="minp" />
        <span style="width:500px; color:red;" class="help-block" id="minp_error"></span>

        <label>Max Point:</label>
        <input class="form-control" id="focusedInput" type="number" ng-model="maxp" />
        <span style="width:500px; color:red;" class="help-block" id="maxp_error"></span>


        <label>Ad ID:</label>
        <input class="form-control" id="focusedInput" type="text" ng-model="adid" />
        <span style="width:500px; color:red;" class="help-block" id="adid_error"></span>

        <br>

        <button type="button" class="btn btn-info pull-right" ng-click="add()" >Create Offer</button>

      </div>

      </div>
    </form>
    </div>
    </div>


    </div>
  
      <div class="modal fade" id="searchModal" role="dialog">
      <div class="modal-dialog">
      
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title"><strong>Search Client</strong></h4>
          </div>
          {% verbatim %}
          <div class="modal-body">
          <label>Search: <input ng-model="searchText"></label>
            <table class="table table-striped table-bordered table-hover table-condensed table-responsive"  
      cellpadding="5" cellspacing="0" border="1">
              <thead>
                <tr>

                  <th>Parent Supplier #</th>
                  <th>Parent Supplier Name</th>
                  <th>Primary Supplier #</th>
                  <th>Primary Supplier Name</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="item in clientlist| filter:searchText">
     
                  <td>{{item.parent_supl_num}}</td>
                  <td>{{item.parent_supl_name}}</td>
                  <td>{{item.primary_supl_num}}</td>
                  <td>{{item.primary_supl_name}}</td>
                  <td>
                    <div class="btn-group-vertical">
                      <button type="button" class="btn btn-success btn-xs" data-toggle="modal"  ng-click="sel_client(item.parent_supl_num, item.parent_supl_name)" data-backdrop="false" data-dismiss="modal">Select Client</button>
                  </div>                    
                  </td>
                </tr>
              </tbody>  
            </table>
          </div>
          {% endverbatim %}
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
          </div>
        </div>
        
      </div>
    </div>

  
</body>


</div>
<div class="container">
    <img src="https://www.precima.com/application/themes/Precima/images-svg/logo-barcode-only.svg"  width="304" height="236" align="left">
</div>

<input type="hidden" id="refreshed" value="no">
<script type="text/javascript">
  onload=function(){
    var e=document.getElementById("refreshed");
    if(e.value=="no")e.value="yes";
    else{e.value="no";location.reload();}
}
</script>

<script type="text/javascript">
    
  <!-- Define crudapp as a Angular application. -->
  var crudapp = angular.module('crudapp', []);
  
  <!-- Application controller for the module. -->
  crudapp.controller('productController', function($scope){
      
    <!-- Populate table with products data -->
    $scope.word = localStorage.getItem('favoriteflavor');
    $scope.otable=false; 
    $scope.oblank=false;

    $scope.selcamp = {{selected_camp|safe}}
    $scope.selsupp = {{selected_supplier|safe}}
    $scope.offers = {{offer_info|safe}};
    $scope.offer_list = {{offer_list|safe}};
    $scope.initofferlist = {{offer_list|safe}};
    $scope.client_name = {{clientname|safe}};
    $scope.client_num = {{clientnum|safe}};
    //$scope.clientlist = {{client_info|safe}};

    $scope.insertlist = [];
    $scope.updatelist = [];
    $scope.deletelist = [];

    

    var olen=$scope.offers.length;
    if (olen!=0){
      $scope.otable=true; 
      $scope.oblank=false;
    }
    else{
      $scope.otable=false; 
      $scope.oblank=true;
    }

    $scope.sel_offer = function(id){
        localStorage.setItem('favoriteflavor','');
        $scope.poidsend = $scope.offers[id-1].precimaOfferID;
        $scope.offeridsend = $scope.offers[id-1].precimaOfferNumber;
    };

    $scope.sel_client = function(num, name){
        $scope.cnum = num;
        $scope.cname = name;
        $scope.searchText = "";
    };

    $scope.sub_data = function(){
        
        data = {"data": [], 
                "delete_list":$scope.deletelist,
                "poid":$scope.poidsend, 
                "offernum" : $scope.offeridsend};
        $.ajax({
            type: 'POST',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            url: '/offer_receive/',
            data: JSON.stringify(data),
            success: function(result) {
                    document.write(result)
                    }
        });
    };

    $scope.export = function(){
        
        data = "product";
        $.ajax({
            type: 'POST',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            url: '/excel_file_export/',
            data: JSON.stringify(data),
            success: function(result) {
                    document.write(result)
                    }
        });
    };

    $scope.wipe = function(){
      $scope.insertlist = [];
      $scope.updatelist = [];
      $scope.deletelist = [];
      $scope.initofferlist = $scope.offer_list;
        
    };

    $scope.sub_data1 = function(){
        
        data = {"insert_list": $scope.insertlist, 
                "update_list":$scope.updatelist, 
                "delete_list":$scope.deletelist, 
                "data": $scope.offers,
                "poid": 'none', 
                "offernum" : ""};
        $.ajax({
            type: 'POST',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            url: '/offer_receive/',
            data: JSON.stringify(data),
            success: function(result) {
                    document.write(result)
                    }
        });
    };

    <!-- Delete function -->
    $scope.del = function(id){
      var result = confirm('Are you sure you want to delete this row?');

      if (result==true){
          var index = getSelectedIndex(id);
          var poid = $scope.offers[index].precimaOfferID;
          $scope.idvalue = index;
          $scope.offers.splice(index, 1);

          if ($scope.insertlist.indexOf(poid) > -1){
            var ind = $scope.insertlist.indexOf(poid);
            $scope.insertlist.splice(ind,1);
            var ind = $scope.offer_list.indexOf(poid);
            $scope.offer_list.splice(ind,1);
          }
          else if($scope.updatelist.indexOf(poid) > -1){
            var ind = $scope.updatelist.indexOf(poid);
            $scope.updatelist.splice(ind,1);
            var ind = $scope.offer_list.indexOf(poid);
            $scope.offer_list.splice(ind,1);
            $scope.deletelist.push(poid);
          }
          else{
            var ind = $scope.offer_list.indexOf(poid);
            $scope.offer_list.splice(ind,1);
            $scope.deletelist.push(poid);
          }
      };
    };

    <!-- Select the row of data and update the form function -->

    $scope.selectEdit = function(id){
      document.getElementById("saved").innerHTML = "";
      var index = getSelectedIndex(id);
      var item = $scope.offers[index];

      document.getElementById("e_pon_e").innerHTML = "";
      document.getElementById("e_bc1_e").innerHTML = "";
      document.getElementById("e_vc1_e").innerHTML = "";
      document.getElementById("e_uc_e").innerHTML = "";
      document.getElementById("e_bc2_e").innerHTML = "";
      document.getElementById("e_vc2_e").innerHTML = "";
      document.getElementById("e_ec_e").innerHTML = "";
      document.getElementById("e_bn_e").innerHTML = "";
      document.getElementById("e_oc_e").innerHTML = "";
      document.getElementById("e_sc_e").innerHTML = "";
      document.getElementById("e_iiddm_e").innerHTML = "";
      document.getElementById("e_iidc_e").innerHTML = "";
      document.getElementById("e_iide_e").innerHTML = "";
      document.getElementById("e_mcf_e").innerHTML = "";
      document.getElementById("e_mini_e").innerHTML = "";
      document.getElementById("e_maxi_e").innerHTML = "";
      document.getElementById("e_minp_e").innerHTML = "";
      document.getElementById("e_maxp_e").innerHTML = "";
      document.getElementById("e_adid_e").innerHTML = "";

      $scope.id = item.id;
      $scope.idvalue = index;
      $scope.editoffer = item.precimaOfferID;

      $scope.e_pon = item.precimaOfferNumber;
      $scope.e_iiddm = item.imageIDDM;
      $scope.e_bc1 = item.barCode1;
      $scope.e_iidc = item.imageIDCatalina;
      $scope.e_vc1 = item.valassisCode1;
      $scope.e_iide = item.imageIDEmail;
      $scope.e_uc = item.unicaCode;
      $scope.e_mcf = item.maxClientFee;
      $scope.e_bc2 = item.barCode2;
      $scope.e_mini = item.minIncentive;
      $scope.e_vc2 = item.valassisCode2;
      $scope.e_maxi = item.maxIncentive;
      $scope.e_ec = item.eCode;
      $scope.e_minp = item.minPoints;
      $scope.e_bn = item.brandName;
      $scope.e_maxp = item.maxPoints;
      $scope.e_oc = item.offerCopy;
      $scope.e_adid = item.adID;
      $scope.e_sc = item.subCopy;
     }

    <!-- Edit and update row function -->
    $scope.edit = function(){

      document.getElementById("e_pon_e").innerHTML = "";
      document.getElementById("e_bc1_e").innerHTML = "";
      document.getElementById("e_vc1_e").innerHTML = "";
      document.getElementById("e_uc_e").innerHTML = "";
      document.getElementById("e_bc2_e").innerHTML = "";
      document.getElementById("e_vc2_e").innerHTML = "";
      document.getElementById("e_ec_e").innerHTML = "";
      document.getElementById("e_bn_e").innerHTML = "";
      document.getElementById("e_oc_e").innerHTML = "";
      document.getElementById("e_sc_e").innerHTML = "";
      document.getElementById("e_iiddm_e").innerHTML = "";
      document.getElementById("e_iidc_e").innerHTML = "";
      document.getElementById("e_iide_e").innerHTML = "";
      document.getElementById("e_mcf_e").innerHTML = "";
      document.getElementById("e_mini_e").innerHTML = "";
      document.getElementById("e_maxi_e").innerHTML = "";
      document.getElementById("e_minp_e").innerHTML = "";
      document.getElementById("e_maxp_e").innerHTML = "";
      document.getElementById("e_adid_e").innerHTML = "";
      var error = false;


      if ($scope.e_bc1){
        str = ($scope.e_bc1).toString();
        if (str.length > 100){
          document.getElementById("e_bc1_e").innerHTML = "This field cannot have an input larger than 100 characters";
          error = true;
        }
      }

      if ($scope.e_vc1){
        str = ($scope.e_vc1).toString();
        if (str.length > 100){
          document.getElementById("e_vc1_e").innerHTML = "This field cannot have an input larger than 100 characters";
          error = true;
        }
      }

      if ($scope.e_uc){
        str = ($scope.e_uc).toString();
        if (str.length > 100){
          document.getElementById("e_uc_e").innerHTML = "This field cannot have an input larger than 100 characters";
          error = true;
        }
      }

      if ($scope.e_bc2){
        str = ($scope.e_bc2).toString();
        if (str.length > 100){
          document.getElementById("e_bc2_e").innerHTML = "This field cannot have an input larger than 100 characters";
          error = true;
        }
      }

      if ($scope.e_vc2){
        str = ($scope.e_vc2).toString();
        if (str.length > 100){
          document.getElementById("e_vc2_e").innerHTML = "This field cannot have an input larger than 100 characters";
          error = true;
        }
      }
      
      if ($scope.e_ec){
        str = ($scope.e_ec).toString();
        if (str.length > 100){
          document.getElementById("e_ec_e").innerHTML = "This field cannot have an input larger than 100 characters";
          error = true;
        }
      }

      if ($scope.e_bn){
        str = ($scope.e_bn).toString();
        if (str.length > 100){
          document.getElementById("e_bn_e").innerHTML = "This field cannot have an input larger than 100 characters";
          error = true;
        }
      }

      if ($scope.e_oc){
        str = ($scope.e_oc).toString();
        if (str.length > 150){
          document.getElementById("e_oc_e").innerHTML = "This field cannot have an input larger than 150 characters";
          error = true;
        }
      }

      if ($scope.e_sc){
        str = ($scope.e_sc).toString();
        if (str.length > 150){
          document.getElementById("e_sc_e").innerHTML = "This field cannot have an input larger than 150 characters";
          error = true;
        }
      }

      if ($scope.e_iiddm){  
        str = ($scope.e_iiddm).toString();
        if (str.length > 150){
          document.getElementById("e_iiddm_e").innerHTML = "This field cannot have an input larger than 150 characters";
          error = true;
        }
      }

      if ($scope.e_iidc){
        str = ($scope.e_iidc).toString();
        if (str.length > 150){
          document.getElementById("e_iidc_e").innerHTML = "This field cannot have an input larger than 150 characters";
          error = true;
        }
      }

      if ($scope.e_iide){
        str = ($scope.e_iide).toString();
        if (str.length > 150){
          document.getElementById("e_iide_e").innerHTML = "This field cannot have an input larger than 150 characters";
          error = true;
        }
      }

      if ($scope.e_mcf){
        str = ($scope.e_mcf).toString();
        ind = str.indexOf(".")
        str_check1 = str.substr(0,ind);
        str_check2 = str.substr(ind);
        if (ind!=-1 && (str_check1.length>6 || str_check2.length>3)){
          document.getElementById("e_mcf_e").innerHTML = "Cannot be longer than 8 digits, with 2 decimals included.";
          error = true;
        }
        else if (ind==-1 && str.length>6){
          document.getElementById("e_mcf_e").innerHTML = "This can only be 8 digits, with 2 decimals included.";
          error = true;
        }
      }

      if ($scope.e_mini){
        str = ($scope.e_mini).toString();
        ind = str.indexOf(".")
        str_check1 = str.substr(0,ind);
        str_check2 = str.substr(ind);
        if (ind!=-1 && (str_check1.length>1 || str_check2.length>3)){
          document.getElementById("e_mini_e").innerHTML = "Cannot be longer than 3 digits, with 2 decimals included.";
          error = true;
        }
        else if (ind==-1 && str.length>1){
          document.getElementById("e_mini_e").innerHTML = "This can only be 3 digits, with 2 decimals included.";
          error = true;
        }
      }

      if ($scope.e_maxi){
        str = ($scope.e_maxi).toString();
        ind = str.indexOf(".")
        str_check1 = str.substr(0,ind);
        str_check2 = str.substr(ind);
        if (ind!=-1 && (str_check1.length>1 || str_check2.length>3)){
          document.getElementById("e_maxi_e").innerHTML = "Cannot be longer than 3 digits, with 2 decimals included.";
          error = true;
        }
        else if (ind==-1 && str.length>1){
          document.getElementById("e_maxi_e").innerHTML = "This can only be 3 digits, with 2 decimals included.";
          error = true;
        }
      }

      if ($scope.e_adid){
        str = ($scope.e_adid).toString();
        if (str.length > 150){
          document.getElementById("e_adid_e").innerHTML = "This field cannot have an input larger than 150 characters";
          error = true;
        }
      }

      if (error==false){

          document.getElementById("e_pon_e").innerHTML = "";
          document.getElementById("e_bc1_e").innerHTML = "";
          document.getElementById("e_vc1_e").innerHTML = "";
          document.getElementById("e_uc_e").innerHTML = "";
          document.getElementById("e_bc2_e").innerHTML = "";
          document.getElementById("e_vc2_e").innerHTML = "";
          document.getElementById("e_ec_e").innerHTML = "";
          document.getElementById("e_bn_e").innerHTML = "";
          document.getElementById("e_oc_e").innerHTML = "";
          document.getElementById("e_sc_e").innerHTML = "";
          document.getElementById("e_iiddm_e").innerHTML = "";
          document.getElementById("e_iidc_e").innerHTML = "";
          document.getElementById("e_iide_e").innerHTML = "";
          document.getElementById("e_mcf_e").innerHTML = "";
          document.getElementById("e_mini_e").innerHTML = "";
          document.getElementById("e_maxi_e").innerHTML = "";
          document.getElementById("e_minp_e").innerHTML = "";
          document.getElementById("e_maxp_e").innerHTML = "";
          document.getElementById("e_adid_e").innerHTML = "";

          var index = getSelectedIndex($scope.id);

          $scope.offers[index].precimaOfferNumber = $scope.e_pon;
          $scope.offers[index].imageIDDM = $scope.e_iiddm;
          $scope.offers[index].barCode1 = $scope.e_bc1;
          $scope.offers[index].imageIDCatalina = $scope.e_iidc;
          $scope.offers[index].valassisCode1 = $scope.e_vc1;
          $scope.offers[index].imageIDEmail = $scope.e_iide;
          $scope.offers[index].unicaCode = $scope.e_uc;
          $scope.offers[index].maxClientFee = $scope.e_mcf;
          $scope.offers[index].barCode2 = $scope.e_bc2;
          $scope.offers[index].minIncentive = $scope.e_mini;
          $scope.offers[index].valassisCode2 = $scope.e_vc2;
          $scope.offers[index].maxIncentive = $scope.e_maxi;
          $scope.offers[index].eCode = $scope.e_ec;
          $scope.offers[index].minPoints = $scope.e_minp;
          $scope.offers[index].brandName = $scope.e_bn;
          $scope.offers[index].maxPoints = $scope.e_maxp;
          $scope.offers[index].offerCopy = $scope.e_oc;
          $scope.offers[index].adID = $scope.e_adid;
          $scope.offers[index].subCopy = $scope.e_sc;
          document.getElementById("saved").innerHTML = "Information is saved, you may now close this window.";

          var poid = $scope.offers[index].precimaOfferID;
          if ($scope.insertlist.indexOf(poid) > -1){
            //do nothing
          }
          else if ($scope.updatelist.indexOf(poid) > -1){
            //do nothing
          }
          else{
            $scope.updatelist.push(poid);
          }
      }
    };
 
    
    <!-- Add a new product function -->
    $scope.add = function(id){
        document.getElementById("pon_error").innerHTML = "";
        document.getElementById("bc1_error").innerHTML = "";
        document.getElementById("vc1_error").innerHTML = "";
        document.getElementById("uc_error").innerHTML = "";
        document.getElementById("bc2_error").innerHTML = "";
        document.getElementById("vc2_error").innerHTML = "";
        document.getElementById("ec_error").innerHTML = "";
        document.getElementById("bn_error").innerHTML = "";
        document.getElementById("oc_error").innerHTML = "";
        document.getElementById("sc_error").innerHTML = "";
        document.getElementById("iiddm_error").innerHTML = "";
        document.getElementById("iidc_error").innerHTML = "";
        document.getElementById("iide_error").innerHTML = "";
        document.getElementById("mcf_error").innerHTML = "";
        document.getElementById("mini_error").innerHTML = "";
        document.getElementById("maxi_error").innerHTML = "";
        document.getElementById("minp_error").innerHTML = "";
        document.getElementById("maxp_error").innerHTML = "";
        document.getElementById("adid_error").innerHTML = "";
    

        var error = false;

        if (!$scope.pon){
            document.getElementById("pon_error").innerHTML = "This is a required field";
            error = true;
        }

        poid = $scope.selsupp + "-" + $scope.pon;

        if ($scope.offer_list.indexOf(poid) > -1){
          document.getElementById("pon_error").innerHTML = "This offer already exists. Please ensure you insert a new offer.";
            error = true;
        }

        if ($scope.bc1){
          str = ($scope.bc1).toString();
          if (str.length > 100){
            document.getElementById("bc1_error").innerHTML = "This field cannot have an input larger than 100 characters";
            error = true;
          }
        }

        if ($scope.vc1){
          str = ($scope.vc1).toString();
          if (str.length > 100){
            document.getElementById("vc1_error").innerHTML = "This field cannot have an input larger than 100 characters";
            error = true;
          }
        }

        if ($scope.uc){
          str = ($scope.uc).toString();
          if (str.length > 100){
            document.getElementById("uc_error").innerHTML = "This field cannot have an input larger than 100 characters";
            error = true;
          }
        }

        if ($scope.bc2){
          str = ($scope.bc2).toString();
          if (str.length > 100){
            document.getElementById("bc2_error").innerHTML = "This field cannot have an input larger than 100 characters";
            error = true;
          }
        }

        if ($scope.vc2){
          str = ($scope.vc2).toString();
          if (str.length > 100){
            document.getElementById("vc2_error").innerHTML = "This field cannot have an input larger than 100 characters";
            error = true;
          }
        }
        
        if ($scope.ec){
          str = ($scope.ec).toString();
          if (str.length > 100){
            document.getElementById("ec_error").innerHTML = "This field cannot have an input larger than 100 characters";
            error = true;
          }
        }

        if ($scope.bn){
          str = ($scope.bn).toString();
          if (str.length > 100){
            document.getElementById("bn_error").innerHTML = "This field cannot have an input larger than 100 characters";
            error = true;
          }
        }

        if ($scope.oc){
          str = ($scope.oc).toString();
          if (str.length > 150){
            document.getElementById("oc_error").innerHTML = "This field cannot have an input larger than 150 characters";
            error = true;
          }
        }

        if ($scope.sc){
          str = ($scope.sc).toString();
          if (str.length > 150){
            document.getElementById("sc_error").innerHTML = "This field cannot have an input larger than 150 characters";
            error = true;
          }
        }

        if ($scope.iiddm){
          str = ($scope.iiddm).toString();
          if (str.length > 150){
            document.getElementById("iiddm_error").innerHTML = "This field cannot have an input larger than 150 characters";
            error = true;
          }
        }

        if ($scope.iidc){
          str = ($scope.iidc).toString();
          if (str.length > 150){
            document.getElementById("iidc_error").innerHTML = "This field cannot have an input larger than 150 characters";
            error = true;
          }
        }

        if ($scope.iide){
          str = ($scope.iide).toString();
          if (str.length > 150){
            document.getElementById("iide_error").innerHTML = "This field cannot have an input larger than 150 characters";
            error = true;
          }
        }

        if ($scope.mcf){
          str = ($scope.mcf).toString();
          ind = str.indexOf(".")
          str_check1 = str.substr(0,ind);
          str_check2 = str.substr(ind);
          if (ind!=-1 && (str_check1.length>6 || str_check2.length>3)){
            document.getElementById("mcf_error").innerHTML = "Cannot be longer than 8 digits, with 2 decimals included.";
            error = true;
          }
          else if (ind==-1 && str.length>6){
            document.getElementById("mcf_error").innerHTML = "This can only be 8 digits, with 2 decimals included.";
            error = true;
          }
        }

        if ($scope.mini){
          str = ($scope.mini).toString();
          ind = str.indexOf(".")
          str_check1 = str.substr(0,ind);
          str_check2 = str.substr(ind);
          if (ind!=-1 && (str_check1.length>1 || str_check2.length>3)){
            document.getElementById("mini_error").innerHTML = "Cannot be longer than 3 digits, with 2 decimals included.";
            error = true;
          }
          else if (ind==-1 && str.length>1){
            document.getElementById("mini_error").innerHTML = "This can only be 3 digits, with 2 decimals included.";
            error = true;
          }
        }

        if ($scope.maxi){
          str = ($scope.maxi).toString();
          ind = str.indexOf(".")
          str_check1 = str.substr(0,ind);
          str_check2 = str.substr(ind);
          if (ind!=-1 && (str_check1.length>1 || str_check2.length>3)){
            document.getElementById("maxi_error").innerHTML = "Cannot be longer than 3 digits, with 2 decimals included.";
            error = true;
          }
          else if (ind==-1 && str.length>1){
            document.getElementById("maxi_error").innerHTML = "This can only be 3 digits, with 2 decimals included.";
            error = true;
          }
        }

        if ($scope.adid){
          str = ($scope.adid).toString();
          if (str.length > 150){
            document.getElementById("adid_error").innerHTML = "This field cannot have an input larger than 150 characters";
            error = true;
          }
        }

        if (error == false){
          $scope.oblank = false;
          $scope.otable = true;
          document.getElementById("pon_error").innerHTML = "";
          document.getElementById("bc1_error").innerHTML = "";
          document.getElementById("vc1_error").innerHTML = "";
          document.getElementById("uc_error").innerHTML = "";
          document.getElementById("bc2_error").innerHTML = "";
          document.getElementById("vc2_error").innerHTML = "";
          document.getElementById("ec_error").innerHTML = "";
          document.getElementById("bn_error").innerHTML = "";
          document.getElementById("oc_error").innerHTML = "";
          document.getElementById("sc_error").innerHTML = "";
          document.getElementById("iiddm_error").innerHTML = "";
          document.getElementById("iidc_error").innerHTML = "";
          document.getElementById("iide_error").innerHTML = "";
          document.getElementById("mcf_error").innerHTML = "";
          document.getElementById("mini_error").innerHTML = "";
          document.getElementById("maxi_error").innerHTML = "";
          document.getElementById("minp_error").innerHTML = "";
          document.getElementById("maxp_error").innerHTML = "";
          document.getElementById("adid_error").innerHTML = "";

          

          $scope.offers.push({
              precimaCampaignID: $scope.selcamp,
              precimaVendorID: $scope.selsupp,
              precimaOfferNumber: $scope.pon,
              barCode1: $scope.bc1,
              valassisCode1: $scope.vc1,
              unicaCode: $scope.uc,
              barCode2: $scope.bc2,
              valassisCode2: $scope.vc2,
              eCode: $scope.ec,
              brandName: $scope.bn,
              offerCopy: $scope.oc,
              subCopy: $scope.sc,
              imageIDDM: $scope.iiddm,
              imageIDCatalina: $scope.iidc,
              imageIDEmail: $scope.iide,
              maxClientFee: $scope.mcf,
              minIncentive: $scope.mini,
              maxIncentive: $scope.maxi,
              minPoints: $scope.minp,
              maxPoints: $scope.maxp,
              adID: $scope.adid,
              precimaOfferID: poid,
              counter: '0'

          });

          $scope.offer_list.push(poid);


        <!-- Resets the form -->
        $scope.pon = '';
        $scope.bc1 = '';
        $scope.vc1 = '';
        $scope.uc = '';
        $scope.bc2 = '';
        $scope.vc2 = '';
        $scope.ec = '';
        $scope.bn = '';
        $scope.oc = '';
        $scope.sc = '';
        $scope.iiddm = '';
        $scope.iidc = '';
        $scope.iide = '';
        $scope.mcf = '';
        $scope.mini = '';
        $scope.maxi = '';
        $scope.minp = '';
        $scope.maxp = '';
        $scope.adid = '';

        if($scope.deletelist.indexOf(poid) > -1){
          var ind = $scope.deletelist.indexOf(poid);
          $scope.deletelist.splice(ind,1);
          $scope.updatelist.push(poid)
        }
        else{
          $scope.insertlist.push(poid);
        }
    };
    }

    <!-- Function finds unique product data based on its id -->
    function getSelectedIndex(id){
        for(var i=0; i<$scope.offers.length; i++)
            if($scope.offers[i].id==id)
                return i;
            return -1;  
    };



    function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
    }

    var csrftoken = getCookie('csrftoken');

    function csrfSafeMethod(method) {
      // these HTTP methods do not require CSRF protection
      return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    $.ajaxSetup({
      crossDomain: false, // obviates need for sameOrigin test
      beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type)) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
      }         
  })

});
</script>


<script>

window.onbeforeunload = function (evt) {
  var message = 'Are you sure you want to leave?';
  if (typeof evt == 'undefined') {
    evt = window.event;
  }
  if (evt) {
    localStorage.setItem('favoriteflavor','');
    evt.returnValue = message;
  }
  return message;
}
</script>

<script type="text/javascript">
  function redirect() {

   setTimeout(function(){
    window.location.href='http://127.0.0.1:8000/Morrison/campaigns/suppliers/offers/products';
  },1000);
    // cancel default behavior
  };

  function exp_redirect() {

   setTimeout(function(){
    window.open('http://127.0.0.1:8000/Morrison/file_download');
  },1000);
    // cancel default behavior
  };

</script>

</html>